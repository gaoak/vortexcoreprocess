%%
% clear;
clc;
close all;
setPlotParameters;
savepng=1;
%%
endpointz = [4	4	4	4	4	4	4	4
3.99047065161716	4.02651246704487	3.92889194580817	4.0329521644097	4.04124285214938	4.04226520972055	4.0329521644097	4.03760868706513
3.91201629444822	3.82375776096224	3.90957738995298	3.84669125819263	3.90098398852437	3.97241736988915	3.86066082615891	3.8932564847469
3.85158346466738	3.66012355419488	3.83910478492474	3.7023390558744	3.75105069734067	3.86531734881434	3.70699557852983	3.75356080508409
3.80315918986652	3.52693292077959	3.78918668634144	3.57195642152245	3.62530019505756	3.74890428242867	3.59058251214416	3.632491216043
3.73356188297901	3.40135318070232	3.73339587027775	3.45088683248135	3.51331424659284	3.62783469338757	3.47882596841392	3.53936076293446
3.6710983475445	3.29860612063909	3.67760505421405	3.35309985671739	3.40897812858252	3.53470424027904	3.3717259473391	3.44623030982593];
endpointx = [-1	-1	-1	-1	-1	-1	-1	-1
-1.35670180120553	-1.35507111287708	-1.34859739520785	-1.34701203456058	-1.31831348487693	-1.29113376269546	-1.34235551190515	-1.3330424665943
-1.43965969472405	-1.61969164477555	-1.44207640399476	-1.61709034857533	-1.59399734466959	-1.55655555405478	-1.61709034857533	-1.60777730326448
-1.57884176552083	-1.81376942489497	-1.54484895947739	-1.79403820948155	-1.77778654031412	-1.76609907354899	-1.78938168682612	-1.78006864151527
-1.64123316260493	-1.9659872916553	-1.60063977554108	-1.9430469344552	-1.93255638927795	-1.90579475321179	-1.9430469344552	-1.92907736648892
-1.69514148754652	-0.105123870510239	-1.66230330908516	-0.089750917595352	-0.070032589947512	-0.038529168385657	-0.080437872284499	-0.066468304318218
-1.7546924121794	-0.23831450392553	-1.71809412514885	-0.215477029291875	-0.201507461325593	-0.159598757426754	-0.206163983981021	-0.19219441601474];
for ii=1:1:length(endpointx(:,1))
    for jj=1:1:length(endpointx(1,:))
        if endpointx(ii,jj) > -1.
            endpointx(ii,jj) = endpointx(ii,jj) - 2.;
        end
    end
end
waistz = [4	4	4	4	4	4	4	4
3.65874128971574	3.59162383419786	3.648254379222	3.57661294417788	3.63980884524802	3.52539119496818	3.56729989886702	3.57195642152245
3.21244396343801	3.35568782067422	3.25183303554996	3.38103899264995	3.40281853717207	3.42294769654879	3.34844333406197	3.38569551530538
2.76010168033299	2.85336886036512	2.89653362932235	2.83156931930959	2.88530685469929	3.31119115281855	2.9200432497627	2.93401281772898
2.45364249339994	2.5717658068585	2.64987949514603	2.62202579981539	2.57576715677165	2.89210411383014	2.58011709591655	2.77569104744447
2.19830626304854	2.37007713340106	2.41790715467067	2.38919966704405	2.43576406509694	2.59408666388283	2.45439098422003	2.5894301412274
1.8996158322552	2.2130812650179	2.08316225828852	2.24484746472582	2.32400834986808	2.46370402953088	2.31935182721265	2.42179532563204];
waistx = [-1	-1	-1	-1	-1	-1	-1	-1
-1.18919489569096	-1.17445447440546	-1.18441487325948	-1.16540765099893	-1.17321685587644	-1.16075112834351	-1.17006417365436	-1.16540765099893
-1.29864593833432	-1.29622867790984	-1.29232210901907	-1.30044680800631	-1.30380387786242	-1.29579028535088	-1.29579028535088	-1.29579028535088
-1.3609116777091	-1.45225199133918	-1.35398564136475	-1.45411205563539	-1.448900611266	-1.43082944235826	-1.44945553297997	-1.44479901032454
-1.34824598508258	-1.60446985809951	-1.36279471758534	-1.59846425795362	-1.59399734466959	-1.54724250874393	-1.60312078060905	-1.57518164467649
-1.28264832416298	-1.76049317152885	-1.35398564136475	-1.75212950558271	-1.73350355462779	-1.68693818840673	-1.73815993761643	-1.70556427902844
-1.31768761950042	-1.91851621429888	-1.35398564136475	-1.90113823055636	-1.88251213993466	-1.81266430010325	-1.89182518524551	-1.83129039072496];
vortexx = [-1	-1	-1	-1	-1	-1	-1	-1
-1.16784597636067	-1.15162181897612	-1.1615056841504	-1.15143808303265	-1.15387063867637	-1.14678156037723	-1.15609460568808	-1.15143808303265
-1.30414046767091	-1.31145046458587	-1.2981948264691	-1.30975985331716	-1.30864043564254	-1.29579028535088	-1.30510333066174	-1.30510333066174
-1.36640571353629	-1.46366833134621	-1.35985835884514	-1.45876857829082	-1.45857372682624	-1.43548596501369	-1.46342510094625	-1.45411205563539
-1.33714798593401	-1.61588619810654	-1.35398564136475	-1.6124338259199	-1.60367046022982	-1.57052512202106	-1.60777730326448	-1.5938077352982
-1.29973383980608	-1.76429861819786	-1.34224020640398	-1.75212950558271	-1.74281659276547	-1.70090775637301	-1.74747298292728	-1.71953384699472
-1.31768761950042	-1.90129469828216	-1.35398564136475	-1.89182518524551	-1.8731990946238	-1.82663386806953	-1.88251213993466	-1.84060343603581];
%%
Reynolds = [2000, 2000, 1000, 1000, 1000, 1000, 800,  400];
Radius =   1.58*[0.05, 0.05, 0.05, 0.05, 0.06, 0.08, 0.05, 0.05];
Height =   [0.2,  0.2,  0.2,  0.2,  0.2,  0.2,  0.2,  0.2];
Gamma =    [2.,   2.,   1.,   1.,   1.,   1.,   1.,   1.];
Ratio = Radius./Height;
tscale =0.2^2 / 1;
time = [0:4:24]'*0.1/tscale;
%+ Re 2000, ^ Re 1000, s Re 800, o Re 400
% b r0.05, h0.2; r r0.06, h0.2; k r0.08, h0.2
%vis --
plottype = {'*b', '+b', '<b', '^b', '^r', '^k', 'sb', 'ob'};
DS = [2,4,7,8, 5,6, 1,3];
legendlabel = {'\Gamma/\nu 2000, \sigma/h 0.25','1000,0.25', '800, 0.25', '400, 0.25', '1000, 0.3', '1000, 0.4', 'no-slip wall 2000,0.25', 'no-slip wall 1000,0.25'};
figure;
for ii=DS
    plot([0], [0], plottype{ii});
    hold on;
end
legend(legendlabel, 'Location', 'Best');
%% vortex column location
columnx = (vortexx + 1.) / Height(1);
figure;
for ii=DS
    plot(time, columnx(:,ii), plottype{ii});
    hold on;
end
plot([0 time(6)], [0 -1./4./pi*time(6)]  , 'r-');
% legend({legendlabel{:} 'speed U_i_0'}, 'Location', 'Best');
xlabel('t\Gamma/h^2')
ylabel('x/h')
axis([0 60 -5 0])
text(10, -3, 'slope U_i_0');
title('streamwise displacement of vortex column')
%% vortex leg root location
footx = (endpointx + 1.) / Height(1);
figure;
for ii=DS
    plot(time, footx(:,ii)  , plottype{ii});
    hold on;
end
plot([0 time(6)], [0 -1./2./pi*time(6)]  , 'r-');
% legend({legendlabel{:} 'speed 2U_i_0'}, 'Location', 'Best');
xlabel('t\Gamma/h^2')
ylabel('x/h')
axis([0 60 -6 0])
title('streamwise displacement of vortex foot')
text(5, -5, 'slope 2U_i_0');
%% leg location
legz = (4. - endpointz) ./ Height(1);
figure;
for ii=DS
    plot(time, legz(:,ii) , plottype{ii});
    hold on;
end
% legend(legendlabel, 'Location', 'Best');
xlabel('t\Gamma/h^2')
ylabel('z/h')
title('axial displacement of vortex foot')
axis([0 60 -1 4])
%% modeling leg z location
legz = (4. - endpointz) ./ Height(1);
velocity = (legz(2:7,:) - legz(1:6,:))/(time(2) - time(1));
figure;
for ii=DS
    timemid = (time(1:6) + time(2:7))*0.5;
    plot(timemid, velocity(:,ii), plottype{ii});
    hold on;
end
% legend(legendlabel, 'Location', 'Best');
xlabel('t\Gamma/h^2')
ylabel('h\Delta z/\Delta t \Gamma')
title('axial velocity of vortex foot')
axis([0 60 -0.03 0.12])
%% disturbance propagation
legz = (4. - waistz) ./ Height(1);
figure;
for ii=DS
    plot(time, legz(:,ii), plottype{ii});
    hold on;
end
% legend(legendlabel, 'Location', 'Best');
xlabel('t\Gamma/h^2')
ylabel('hz/t \Gamma')
title('axial displacement of disturbance')
plot([30 60]', 8 + [0 30]' * 0.024 * 0.2/0.05, 'b-')
plot([50 60]', 5.5 + [0 10]' * 0.024 * 0.2/0.08, 'k-')
text(10, 9, 'slope 0.024 h/\sigma')
axis([0 60 0 12])
%% modeling disturbance propagation
legz = (4. - waistz) ./ Height(1);
velocity = (legz(2:7,:) - legz(1:6,:))/(time(2) - time(1));
figure;
for ii=DS
%     realratio1 = sqrt(1*2./Reynolds(ii)*time + Ratio(ii)^2);
    timemid = (time(1:6) + time(2:7))*0.5;
    plot(timemid, velocity(:,ii), plottype{ii});
    hold on;
end
% legend(legendlabel, 'Location', 'Best');
xlabel('t\Gamma/h^2')
ylabel('h\Delta z/\Delta t \Gamma')
title('axial velocity of disturbance')
axis([0 60 0 0.3])
%% wave length / height
wavelen = (endpointz - waistz);
figure;
for ii=DS
    plot(time, wavelen(:,ii) ./ Height(ii), plottype{ii});
    hold on;
end
% plot([0 60], [3 3], 'r--')
% plot([0 60], [4 4], 'r--')
% plot([0 60], [5 5], 'r--')
xlabel('t\Gamma/h^2')
ylabel('\lambda/h')
title('L-vortex wavelength / h')
axis([0 60 0 6])
if savepng>0
    saveas(gcf, 'vortexmotion/wavelength_height.png')
end
%% wave length / height
wavelen = (endpointz - waistz);
figure;
for ii=DS
    lent = length(time);
    plot(time(2:lent)*0 + Radius(ii) ./ Height(ii), wavelen(2:lent,ii) ./ Height(ii)  , plottype{ii});
    hold on;
end
% plot([0 60], [3 3], 'r--')
% plot([0 60], [4 4], 'r--')
% plot([0 60], [5 5], 'r--')
xlabel('a/h')
ylabel('\lambda/h')
title('L-vortex wavelength / h')
axis([0 0.8 0 6])
if savepng>0
    saveas(gcf, 'vortexmotion/wavelength_height_ah.png')
end
%% wave length / radius
wavelen = (endpointz - waistz);
figure;
for ii=DS
    plot(time, wavelen(:,ii) ./ Radius(ii)  , plottype{ii});
    hold on;
end
xlabel('t\Gamma/h^2')
ylabel('\lambda/a')
title('L-vortex wavelength / radius')
axis([0 60 0 14])
if savepng>0
    saveas(gcf, 'vortexmotion/wavelength_radius.png')
end
%% wave length / radius
wavelen = (endpointz - waistz);
figure;
for ii=DS
    lenz = length(time);
    plot(time(2:lenz)*0 + Radius(ii) ./ Height(ii), wavelen(2:lenz,ii) ./ Radius(ii)  , plottype{ii});
    hold on;
end
% plot([0 60], [3 3], 'r--')
% plot([0 60], [4 4], 'r--')
% plot([0 60], [5 5], 'r--')
xlabel('a/h')
ylabel('\lambda/r')
title('L-vortex wavelength / radius')
axis([0 0.8 0 14])
if savepng>0
    saveas(gcf, 'vortexmotion/wavelength_radius_ah.png')
end
%% comparision with plunging motion
plungwavel = -[-1.42912000000000,-1.13581000000000,-1.27845000000000;-0.455640000000000,-0.817900000000000,-0.586080000000000;-0.512030000000000,-0.556390000000000,-0.376810000000000;-0.642340000000001,-0.645359999999999,-0.448070000000000;-0.668089999999999,-0.357440000000000,-0.465740000000000;-0.504239999999999,-0.392940000000000,-0.387659999999999;-0.512580000000000,-0.430530000000000,-0.612600000000000;-0.580350000000000,-0.429240000000000,-0.364320000000000;-0.566770000000000,-0.615850000000001,-0.232440000000000;-0.599340000000000,-0.409040000000000,-0.149410000000001;-0.615790000000000,-0.261830000000000,-0.0487500000000001;-0.497970000000000,-0.284440000000000,-0.272160000000000;-0.494590000000000,-0.290770000000000,-0.247810000000000;-0.483660000000000,-0.305510000000000,-0.218700000000000];
plungheight = [0.129794350631085,0.100044120769022,0.0865927533764399;0.134668256351714,0.139203709269124,0.127541995855112;0.179186776618145,0.176070254670430,0.167360450597248;0.226516997606179,0.209919490245672,0.190042071667137;0.252986398843040,0.234289898919662,0.217650698996224;0.247409079971661,0.245631902701924,0.219761730812606;0.242051095237977,0.244311834919753,0.219114827981498;0.233087472963399,0.233754762032637,0.208982062436443;0.214827878197941,0.221227627406713,0.197133938188950;0.205873068816629,0.213081800906937,0.202818844809415;0.203644772172645,0.215826108709923,0.216830271020752;0.218826960532681,0.232837283745855,0.249073450815691;0.253003196464479,0.272665499864566,0.301659633118517;0.311913746842873,0.326178915464518,0.329149629966862];
plungtT = [0.250000000000000;0.312500000000000;0.375000000000000;0.437500000000000;0.500000000000000;0.562500000000000;0.625000000000000;0.687500000000000;0.750000000000000;0.812500000000000;0.875000000000000;0.937500000000000;1;1.06250000000000];
plunggamma = [1.06959406570252,1.21499067530278,1.28875787539288;1.41512407155857,1.57228649996652,1.64484394040274;1.68415952585837,1.80004505197701,1.74851601309839;1.75596876261221,1.86786161972816,1.94154920631372;2.01746407911052,2.00760665284683,1.96194525954703;2.07741161584568,2.11953482375282,1.96901019945528;2.07771040279709,2.12930919927781,1.93485652274792;2.04277790265853,2.11578635469372,1.86539796689852;2.00320595655429,2.10097512866072,1.78856004772378;1.91800795164745,2.08892902291075,1.66186568452940;1.81793739003889,2.07399957890169,1.49669103753972;1.72706525536922,2.04088000708605,1.50563389228306;1.66596169928876,2.00712025068039,1.37580105787980;1.60329110418181,1.98853826677873,1.05938929731642];
scaledwavel = 2. * plungwavel ./ plungheight;
symbol = {'og', 'sb', 'vk'};
figure;
index = [5:1:7]';
for ii=1:1:3
    scaledtT = (plungtT - 0.25).*plunggamma(:,ii)./plungheight(:,ii)./plungheight(:,ii);
%     plot(plungtT, scaledtT, symbol{ii});
    plot(scaledtT(index), scaledwavel(index,ii),symbol{ii});
    hold on;
end
xlabel('(t-0.25T)\Gamma/h^2')
ylabel('\lambda/h')
title('plunging wavelength')
axis([0 60 0 7])
legend('Re 400', 'Re 1000', 'Re 10k', 'Location', 'Best')